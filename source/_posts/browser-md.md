---
title: 浏览器解析过程
date: 2017-11-09 19:29:52
tags: [浏览器运行机制]
---

### 页面解析过程

1. html文件是边下载边解析的
1. js会阻塞dom的解析
2. css会阻塞render tree的形成
2. css下载之后，会解析成css rule tree
3. js放到尾部 不会阻塞之前的dom结构的展示！！！
3. 外链的js脚本下载之后就会马上解析
  > 下载和解析的过程都会阻塞浏览器的渲染 （遇到了script外链 就会马上开始下载 下载完成之后就马上开始解析执行）




### js脚本异步加载

1. 使用defer属性 作用是：异步的加载js脚本
  1. 不会阻塞页面的渲染 会异步的加载 等到dom构建完成之后 再去执行脚本（异步的下载 dom之后执行）
2. 使用async属性（html5新增）
  1. 不会阻塞页面的渲染 并且下载完成之后异步的解析执行（异步下载 异步执行）


同时拥有async 和 defer的时候 , async优先级高


###
1.http协议的网页加载https的外部资源（非跨域情况）都能无伤加载
2.https协议的网页不能加载http的外部资源


> 浏览器的组成
浏览器就是请求资源 展示到用户面前
1. 用户界面 UI
2. 呈现引擎 负责显示请求的内容
3. 网络 用于网络调用
4. 用户界面后端
5. JavaScript 解释器
6. 数据存储


> css解析规则 是从右向左
原因如下：

```
div p em{}

```


### 处理script和style sheet的顺序

#### scripts（阻塞dom tree）

* web的模型是同步的。
* 当浏览器（render engine）解析到内嵌script标签的时候，立即解析执行。文档的将停止解析，直到脚本被执行完毕。
* 如果是外链的script标签， 脚本资源必须先从网络上下载完毕（这个过程也是同步的）同时文档的解析也将停止直到下载完毕并且解析执行。
* 浏览器对这个同步模型都做了优化。在执行脚本的同时，另外的一个线程将会解析剩余的文档，找到其他需要加载的资源并且加载他们。通过这种方式，资源可以被并行的加载以提高整体速度。注意点地方：只会并行的加载外部资源的引用，如：script，style，image。



#### style sheets （阻塞 render tree  因为需要css rule + dom tree）

> 另一方面，样式表的处理有这不同的模型。理论上来说，由于样式表不会改变dom结构，所以没有必要等待他们而停止文档解析。但是有一个问题：在文档解析阶段，脚本访问了样式信息，如果样式表没有下载完成，解析完毕，脚本将得到错误的答案，这样会引起很多问题。貌似是一个极端情况，却很常见。

1. firfox将会阻止所有的脚本，当还有没下载和解析的脚本时。
2. WebKit仅在用户尝试访问未加载样式表可能影响的某些样式属性时阻止脚本。

